{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}Smart ATS{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'css/theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/pages/sidebar.css' %}">

    {% block extra_css %}{% endblock %}
</head>

<body>

{% if messages %}
<div class="alert-container">
    {% for msg in messages %}
        <div class="alert
            {% if 'success' in msg.tags %}alert-success
            {% elif 'error' in msg.tags %}alert-error
            {% elif 'warning' in msg.tags %}alert-warning
            {% else %}alert-info
            {% endif %}">
            <span>{{ msg }}</span>
            <button class="alert-close">&times;</button>
        </div>
    {% endfor %}
</div>
{% endif %}
<!-- OVERLAY -->
<div class="sidebar-overlay"></div>

{% include "components/sidebar.html" %}

<div class="page-content" style="animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1);">
    {% block content %}{% endblock %}
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const sidebar = document.getElementById("sidebar");
    const toggle = document.getElementById("toggleSidebar");
    const overlay = document.querySelector(".sidebar-overlay");
    const content = document.querySelector(".page-content");

    const isDesktop = () => window.innerWidth >= 769;

    function openSidebar() {
        sidebar.classList.add("open");
        if (isDesktop()) {
            content.classList.add("shift");
        } else {
            overlay.classList.add("active");
            document.body.classList.add("no-scroll");
        }
    }

    function closeSidebar() {
        sidebar.classList.remove("open");
        content.classList.remove("shift");
        overlay.classList.remove("active");
        document.body.classList.remove("no-scroll");
    }

    toggle.addEventListener("click", () => {
        sidebar.classList.contains("open") ? closeSidebar() : openSidebar();
    });

    overlay.addEventListener("click", closeSidebar);

    window.addEventListener("resize", () => {
        if (isDesktop()) {
            overlay.classList.remove("active");
            document.body.classList.remove("no-scroll");
        } else {
            content.classList.remove("shift");
        }
    });

    setTimeout(() => {
        document.body.classList.add("sidebar-ready");
    }, 10);
});



    // Alert close and auto-dismiss
    document.querySelectorAll(".alert").forEach(alert => {
        const closeBtn = alert.querySelector(".alert-close");
        
        // Close on button click
        if (closeBtn) {
            closeBtn.addEventListener("click", () => dismissAlert(alert));
        }
        
        // Auto-dismiss after 5 seconds
        setTimeout(() => dismissAlert(alert), 5000);
    });
    
    function dismissAlert(alert) {
        if (alert.classList.contains("hide")) return;
        alert.classList.add("hide");
        setTimeout(() => alert.remove(), 300);
    }

function togglePassword(fieldId, icon) {
    const input = document.getElementById(fieldId);

    if (!input) return;

    if (input.type === "password") {
        input.type = "text";
        if (icon) icon.classList.add("active");
    } else {
        input.type = "password";
        if (icon) icon.classList.remove("active");
    }
}


document.addEventListener("DOMContentLoaded", () => {

    const logoutBtn = document.getElementById("logoutConfirmBtn");
    const popup = document.getElementById("logoutPopup");
    const yesBtn = document.getElementById("logoutYes");
    const noBtn = document.getElementById("logoutNo");

    if (logoutBtn && popup) {
        logoutBtn.addEventListener("click", (e) => {
            e.preventDefault();
            popup.style.display = "flex";
        });
    }

    if (noBtn) {
        noBtn.addEventListener("click", () => {
            popup.style.display = "none";
        });
    }

    if (yesBtn) {
        yesBtn.addEventListener("click", () => {
            window.location.href = "{% url 'logout_user' %}";
        });
    }

});

</script>

</body>
</html>
