{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}Smart ATS{% endblock %}</title>

    <link rel="stylesheet" href="{% static 'css/theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/pages/sidebar.css' %}">

    <!-- Apply sidebar state BEFORE page renders -->
    <script>
        document.documentElement.classList.add(
            localStorage.getItem("sidebar_open") === "true" ? "sidebar-open" : "sidebar-closed"
        );
    </script>

    {% block extra_css %}{% endblock %}
</head>

<body>

{% if messages %}
    <div class="alert-container">
        {% for msg in messages %}
            <div class="alert 
                {% if 'success' in msg.tags %}alert-success
                {% elif 'error' in msg.tags %}alert-error
                {% elif 'warning' in msg.tags %}alert-warning
                {% else %}alert-info
                {% endif %}
            ">
                <span>{{ msg }}</span>
                <button class="alert-close">&times;</button>
            </div>
        {% endfor %}
    </div>
{% endif %}
    <div class="sidebar-overlay"></div>
    {% include "components/sidebar.html" %}

<!-- MAIN CONTENT -->
<div class="page-content">
    {% block content %}{% endblock %}
</div>

{% block extra_js %}{% endblock %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const menu = document.getElementById("sidebar");
    const toggle = document.getElementById("toggleSidebar");
    const content = document.querySelector(".page-content");
    const overlay = document.querySelector(".sidebar-overlay");

    if (!menu || !toggle) return;

    const isDesktop = () => window.innerWidth > 768;

    // Restore state (desktop only)
    if (localStorage.getItem("sidebar_open") === "true" && isDesktop()) {
        menu.classList.add("open");
        content.classList.add("shift");
    }

    setTimeout(() => {
        document.body.classList.add("sidebar-ready");
    }, 10);

    toggle.addEventListener("click", () => {
        const isOpen = menu.classList.toggle("open");

        if (isDesktop()) {
            content.classList.toggle("shift");
        } else {
            overlay.classList.toggle("active", isOpen);
            document.body.classList.toggle("no-scroll", isOpen);
        }

        localStorage.setItem("sidebar_open", isOpen);
    });

    overlay.addEventListener("click", () => {
        menu.classList.remove("open");
        content.classList.remove("shift");
        overlay.classList.remove("active");
        document.body.classList.remove("no-scroll");
        localStorage.setItem("sidebar_open", false);
    });
});
</script>



</body>
</html>
