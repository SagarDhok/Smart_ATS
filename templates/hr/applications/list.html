{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/applications_list.css' %}">
{% endblock %}

{% block content %}
<div class="page-container">

    <h1>Applications</h1>

    <!-- FILTER BAR -->
    <div class="apps-filter-bar">
        <form method="GET" class="apps-filter-form">

            <input type="text" name="search" placeholder="Search candidate or email..."
                   value="{{ search }}" class="apps-input">

            <button type="submit" class="btn btn-primary apps-btn">Search</button>

            <select name="status" class="apps-select" onchange="this.form.submit()">
                <option value="">All Status</option>
                <option value="screening" {% if status_filter == "screening" %}selected{% endif %}>
                    Screening ({{ counts.screening }})
                </option>
                <option value="review" {% if status_filter == "review" %}selected{% endif %}>
                    Review ({{ counts.review }})
                </option>
                <option value="interview" {% if status_filter == "interview" %}selected{% endif %}>
                    Interview ({{ counts.interview }})
                </option>
                <option value="hired" {% if status_filter == "hired" %}selected{% endif %}>
                    Hired ({{ counts.hired }})
                </option>
                <option value="rejected" {% if status_filter == "rejected" %}selected{% endif %}>
                    Rejected ({{ counts.rejected }})
                </option>
            </select>

        </form>
    </div>

    <!-- TABLE -->
    <table class="table mt-3">
        <thead>
            <tr>
                <th>Candidate</th>
                <th>Email</th>
                <th>Job</th>
                <th>Score</th>
                <th>Status</th>
                <th>Applied On</th>
            </tr>
        </thead>

        <tbody>
        {% for app in apps_page %}
            <tr>
                <td><a href="{% url 'hr_application_detail' app.id %}" class="table-link">{{ app.full_name }}</a></td>
                <td>{{ app.email }}</td>
                <td>
    <a href="{% url 'hr_job_detail' app.job.id %}" class="table-link">
        {{ app.job.title }}
    </a>
</td>

                <td><span class="count-pill">{{ app.match_score }}%</span></td>
                <td>{{ app.status|title }}</td>
                <td>{{ app.applied_at|date:"Y-m-d H:i" }}</td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="6" style="text-align:center;color:#777;padding:20px;">
                    No applications found.
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- PAGINATION -->
<div class="pagination-controls mt-3">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}&search={{ search }}&status={{ status_filter }}"
           class="btn btn-outline">Previous</a>
    {% endif %}

    <span class="page-info">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}&search={{ search }}&status={{ status_filter }}"
           class="btn btn-outline">Next</a>
    {% endif %}
</div>


</div>
{% endblock %}
